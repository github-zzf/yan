(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-growSend-growSend"],{"598b":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",[n("v-uni-view",{staticClass:"form_group_box"},[n("v-uni-view",{staticClass:"uni-list form_group"},[n("v-uni-textarea",{attrs:{name:"content","placeholder-style":"color:#cccccc;font-size:32upx",maxlength:"200",placeholder:"添加笔记的描述"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),n("v-uni-view",{staticClass:"uni-list list-pd"},[n("v-uni-view",{staticClass:"uni-list-cell cell-pd"},[n("v-uni-view",{staticClass:"uni-uploader"},[n("v-uni-view",{staticClass:"uni-uploader-head"},[n("v-uni-view",{staticClass:"uni-uploader-title"},[t._v("点击可预览选好的图片")]),n("v-uni-view",{staticClass:"uni-uploader-info"},[t._v(t._s(t.imageList.length)+"/9")])],1),n("v-uni-view",{staticClass:"uni-uploader-body"},[n("v-uni-view",{staticClass:"uni-uploader__files"},[t._l(t.imageList,function(e,i){return[n("v-uni-view",{key:i+"_0",staticClass:"uni-uploader__file",on:{touchstart:function(e){e.stopPropagation(),e=t.$handleEvent(e),t.touchstart(i)},touchend:function(e){e.stopPropagation(),e=t.$handleEvent(e),t.touchend(e)}}},[n("v-uni-image",{staticClass:"uni-uploader__img",attrs:{src:e,"data-src":e},on:{click:function(e){e.stopPropagation(),e=t.$handleEvent(e),t.previewImage(e)}}})],1)]}),n("v-uni-view",{staticClass:"uni-uploader__input-box"},[n("v-uni-view",{staticClass:"uni-uploader__input",on:{click:function(e){e=t.$handleEvent(e),t.chooseImage(e)}}})],1)],2)],1)],1)],1)],1)],1),n("v-uni-view",{staticClass:"send_btn",on:{click:function(e){e=t.$handleEvent(e),t.submit()}}},[t._v("发布成长笔记")])],1)},o=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return o})},"5ef8":function(t,e,n){"use strict";var i,o=n("288e"),a=o(n("795b"));function s(){var t=0,e=plus.ios.import("PHPhotoLibrary"),n=e.authorizationStatus();return t=0===n?null:3==n?1:0,plus.ios.deleteObject(e),t}function r(){var t=0,e=plus.ios.import("AVCaptureDevice"),n=e.authorizationStatusForMediaType("vide");return t=0===n?null:3==n?1:0,plus.ios.deleteObject(e),t}function u(){var t=0,e=plus.ios.import("CLLocationManager"),n=e.locationServicesEnabled(),i=e.authorizationStatus();return t=n?0===i?null:3===i||4===i?1:0:2,plus.ios.deleteObject(e),t}function c(){var t=0,e=plus.ios.import("UIApplication"),n=e.sharedApplication(),i=0;if(n.currentUserNotificationSettings){var o=n.currentUserNotificationSettings();i=o.plusGetAttribute("types"),0==i?(t=0,console.log("推送权限没有开启")):(t=1,console.log("已经开启推送功能!")),plus.ios.deleteObject(o)}else i=n.enabledRemoteNotificationTypes(),0==i?(t=3,console.log("推送权限没有开启!")):(t=4,console.log("已经开启推送功能!"));return plus.ios.deleteObject(n),plus.ios.deleteObject(e),t}function l(){var t=0,e=plus.ios.import("CNContactStore");e.authorizationStatusForEntityType(0);return t=0===authStatus?null:3==authStatus?1:0,plus.ios.deleteObject(e),t}function d(){var t=null,e=plus.ios.import("AVAudioSession"),n=e.sharedInstance(),i=n.recordPermission();return console.log("permissionStatus:"+i),t=1970168948===i?null:1735552628===i?1:0,plus.ios.deleteObject(e),t}function p(){var t=null,e=plus.ios.import("EKEventStore"),n=e.authorizationStatusForEntityType(0);return 3==n?(t=1,console.log("日历权限已经开启")):console.log("日历权限没有开启"),plus.ios.deleteObject(e),t}function f(){var t=null,e=plus.ios.import("EKEventStore"),n=e.authorizationStatusForEntityType(1);return 3==n?(t=1,console.log("备忘录权限已经开启")):console.log("备忘录权限没有开启"),plus.ios.deleteObject(e),t}function g(t){return new a.default(function(e,n){switch(t){case"push":e(c());break;case"location":e(u());break;case"record":e(d());break;case"camera":e(r());break;case"album":e(s());break;case"contact":e(l());break;case"calendar":e(p());break;case"memo":e(f());break;default:e(0);break}})}function h(t){return new a.default(function(e,n){plus.android.requestPermissions([t],function(t){for(var n=0,i=0;i<t.granted.length;i++){var o=t.granted[i];console.log("已获取的权限："+o),n=1}for(i=0;i<t.deniedPresent.length;i++){var a=t.deniedPresent[i];console.log("拒绝本次申请的权限："+a),n=0}for(i=0;i<t.deniedAlways.length;i++){var s=t.deniedAlways[i];console.log("永久拒绝申请的权限："+s),n=-1}e(n)},function(t){console.log("result error: "+t.message),e({code:t.code,message:t.message})})})}function v(){if(b.isIOS){var t=plus.ios.import("UIApplication"),e=t.sharedApplication(),n=plus.ios.import("NSURL"),i=n.URLWithString("app-settings:");e.openURL(i),plus.ios.deleteObject(i),plus.ios.deleteObject(n),plus.ios.deleteObject(e)}else{var o=plus.android.importClass("android.content.Intent"),a=plus.android.importClass("android.provider.Settings"),s=plus.android.importClass("android.net.Uri"),r=plus.android.runtimeMainActivity(),u=new o;u.setAction(a.ACTION_APPLICATION_DETAILS_SETTINGS);var c=s.fromParts("package",r.getPackageName(),null);u.setData(c),r.startActivity(u)}}function m(){var t=plus.ios.import("UIApplication"),e=t.sharedApplication(),n=plus.ios.import("NSURL"),i=n.URLWithString("App-prefs:root=General");e.openURL(i),plus.ios.deleteObject(i),plus.ios.deleteObject(n),plus.ios.deleteObject(e)}var b={get isIOS(){return"boolean"===typeof i?i:i="ios"===uni.getSystemInfoSync().platform},requestIOS:g,requestAndroid:h,gotoAppSetting:v,gotoiOSSetting:m};t.exports=b},"8d7f":function(t,e,n){"use strict";n.r(e);var i=n("598b"),o=n("d7a6");for(var a in o)"default"!==a&&function(t){n.d(e,t,function(){return o[t]})}(a);n("8e02");var s=n("2877"),r=Object(s["a"])(o["default"],i["a"],i["b"],!1,null,"634b7aed",null);e["default"]=r.exports},"8e02":function(t,e,n){"use strict";var i=n("9f85"),o=n.n(i);o.a},"9f85":function(t,e,n){var i=n("abfe");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=n("4f06").default;o("33b2e6a7",i,!0,{sourceMap:!1,shadowMode:!1})},abfe:function(t,e,n){e=t.exports=n("2350")(!1),e.push([t.i,"uni-page-body[data-v-634b7aed]{background:#f8f8f8}.form_group[data-v-634b7aed]{padding:%?35?% %?30?%;background:#fff;margin-top:%?30?%}.form_group uni-input[data-v-634b7aed],.form_group uni-textarea[data-v-634b7aed]{font-size:%?30?%}.input_placeholder[data-v-634b7aed]{font-size:%?32?%;color:#ccc}.add_img[data-v-634b7aed]{width:%?120?%;height:%?120?%;margin-right:%?20?%}.send_btn[data-v-634b7aed]{width:90%;height:%?90?%;background:#ffc122;font-size:#FFFFFF;font-size:%?32?%;color:#fff;line-height:%?90?%;text-align:center;border-radius:%?90?%;margin:0 auto;position:fixed;bottom:%?30?%;left:50%;margin-left:-45%}.cell-pd[data-v-634b7aed]{padding:%?22?% %?30?%}.list-pd[data-v-634b7aed]{margin-top:%?30?%}body.?%PAGE?%[data-v-634b7aed]{background:#f8f8f8}",""])},d7a6:function(t,e,n){"use strict";n.r(e);var i=n("e9d0"),o=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);e["default"]=o.a},e9d0:function(t,e,n){"use strict";var i=n("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("ac6a");var o=i(n("795b"));n("96cf");var a=i(n("3b8d")),s=i(n("e814")),r=i(n("cebc")),u=n("2f62"),c=(i(n("5ef8")),[["camera"],["album"],["camera","album"]]),l=[["compressed"],["original"],["compressed","original"]],d={computed:(0,u.mapState)(["forcedLogin","hasLogin","userName"]),data:function(){return{title:"choose/previewImage",imageList:[],sourceTypeIndex:2,sourceType:["拍照","相册","拍照或相册"],sizeTypeIndex:2,sizeType:["压缩","原图","压缩或原图"],countIndex:8,count:[1,2,3,4,5,6,7,8,9],content:"",temp:!1}},onUnload:function(){this.imageList=[],this.sourceTypeIndex=2,this.sourceType=["拍照","相册","拍照或相册"],this.sizeTypeIndex=2,this.sizeType=["压缩","原图","压缩或原图"],this.countIndex=8},methods:(0,r.default)({},(0,u.mapMutations)(["login"]),{sourceTypeChange:function(t){this.sourceTypeIndex=(0,s.default)(t.target.value)},sizeTypeChange:function(t){this.sizeTypeIndex=(0,s.default)(t.target.value)},countChange:function(t){this.countIndex=t.target.value},chooseImage:function(){var t=(0,a.default)(regeneratorRuntime.mark(function t(){var e,n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!(this.imageList.length>=9)){t.next=7;break}return t.next=3,this.isFullImg();case 3:if(e=t.sent,console.log("是否继续?",e),e){t.next=7;break}return t.abrupt("return");case 7:uni.chooseImage({sourceType:c[this.sourceTypeIndex],sizeType:l[this.sizeTypeIndex],count:this.imageList.length+this.count[this.countIndex]>9?9-this.imageList.length:this.count[this.countIndex],success:function(t){n.imageList=n.imageList.concat(t.tempFilePaths)},fail:function(t){}});case 8:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),isFullImg:function(){var t=this;return new o.default(function(e){uni.showModal({content:"已经有9张图片了,是否清空现有图片？",success:function(n){n.confirm?(t.imageList=[],e(!0)):e(!1)},fail:function(){e(!1)}})})},previewImage:function(t){var e=t.target.dataset.src;uni.previewImage({current:e,urls:this.imageList})},touchstart:function(t){var e=this;clearInterval(this.Loop),this.Loop=setTimeout(function(){uni.showModal({title:"删除",content:"请问要删除这个图片吗？",success:function(n){n.confirm?e.imageList=e.imageList.splice(0,t):n.cancel&&console.log("用户点击取消")}})}.bind(this),1e3)},touchend:function(){clearInterval(this.Loop)},submit:function(t){var e=this;if(""==this.content)return uni.showToast({title:"请添加笔记描述",icon:"none"}),!1;this.temp||(this.temp=!0,this.$http.request({url:"/m/saveGrowup",data:{content:this.content}}).then(function(t){if(1==t.data.code){var n=t.data.data;e.imageList.length>0?e.imageList.forEach(function(t){e.$http.upload("/m/saveGrowupImg",{name:"files",filePath:t,formData:{id:n}}).then(function(t){1==t.data.code&&(e.msg(),e.content="",e.imageList=[])}).catch(function(t){uni.showToast({title:"提交失败",icon:"none"}),e.temp=!1})}):e.msg()}}).catch(function(t){e.temp=!1}))},msg:function(){this.$msgbox({title:"发布提示",content:"发布成功",confirm:"确定",close:!0}).then(function(){uni.switchTab({url:"/pages/tabBar/growRecord/growRecord",success:function(t){var e=getCurrentPages().pop();e.initData()}})}),this.content="",this.temp=!1}}),onLoad:function(){if(!this.hasLogin){var t=this;this.$weixin.loginBack(function(){t.login()})}this.$loadingHiden()}};e.default=d}}]);